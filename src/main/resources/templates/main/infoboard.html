<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì •ë³´ê²Œì‹œíŒ</title>
    <link rel="stylesheet" type="text/css" href="../../static/css/infoboard.css" th:href="@{/css/infoboard.css}">
</head>
<body>
  <div>
    <div class="leftBar" th:insert="~{main/sidebar :: sidebar}">
    </div>
  </div>
  <div class="maincontent">
      <div id="top">
        <div class="introduce">
          <div>ì§€ì—­ë³„ ì •ë³´</div>
          <h2 id="subT">ì§€ì—­ì„ ì„ íƒí•˜ê³  ê·¸ ì§€ì—­ì˜ ê¶ê¸ˆí•œ ì •ë³´ë¥¼ ì§ˆë¬¸í•˜ê³  ë‹µí•˜ë©° ì†Œí†µí•´ìš”!<br>
            ë˜í•œ ë§Œì•½ ìš°ë¦¬ë™ë„¤ ìë‘ê±°ë¦¬ê°€ ìˆë‹¤ë©´ ìë‘í•´ì£¼ì„¸ìš”! (ë§›ì§‘ì†Œê°œ, ê°ˆë§Œí•œ ê³³ ì¶”ì²œ ë“±) </h2>
        </div>
        <div id="weatherWidget">
          <div class="widgetElementContainer">
              <img class="widgetElement" id="currentSky" src="https://basmilius.github.io/weather-icons/production/line/all/star.svg">
          </div>
          <div class="widgetElementContainer">
              <p class="widgetElement" id="currentLocation1"></p>
              <p class="widgetElement" id="currentLocation2">Loading...</p>
              <p class="widgetElement" id="currentTemp"></p>
          </div>
          <div class="widgetElementContainer">
              <p class="widgetElement">
                  <span id="currentMax">ğŸ”¥</span>
                  <span>/</span>
                  <span id="currentMin">ğŸ’§</span>
              </p>
          </div>
        </div>
      </div>
      <div id="mainLayout">
          <div id="option">
              <div id="optionselect">
                  <div>
                      <select id="userLocation">
                          <option value="">ì‹œ/ë„ ì„ íƒ</option>
                      </select>
                  </div>
                  <div>
                      <select id="userLocation2">
                          <option value="">ì‹œ/êµ°/êµ¬ ì„ íƒ</option>
                      </select>
                  </div>
                  <button onclick="goToBoard()">Go</button>
              </div>
              <div>
                  <select id="searchoption">
                      <option value="">ì˜µì…˜ì„ íƒ</option>
                      <option>ì œëª©</option>
                      <option>ì‘ì„±ì</option>
                  </select>
                  <button id="searchbox">ê²€ìƒ‰</button>
              </div>
          </div>
          <div id="board">
              <table>
                  <tr>
                      <th>ë²ˆí˜¸</th>
                      <th>ìœ í˜•</th>
                      <th class="boardtitle">ì œëª©</th>
                      <th>ì‘ì„±ì</th>
                      <th>ì‘ì„±ì¼</th>
                      <th>ì¡°íšŒìˆ˜</th>
                  </tr>

                  <!--UserIdì™€ titleì˜ ìˆœì„œë¥¼ ë°”ê¿ˆ ì™œ UserId ìë¦¬ì— titleì´ ì˜¤ê³  title ìë¦¬ì— UserIdê°€ ì˜¤ëŠ” ê±¸ê¹Œ???-->
                  <tr th:each="board: ${boardList}">
                      <td th:text="${board.id}"></td>
                      <td th:text="${board.postType}"></td>
                      <td><a th:href="@{|/board/${board.id}|(page=${boardList.number + 1})}" th:text="${board.title}"></a></td>
<!--                      <td><a th:text="${board.userId}"></a></td>-->
                      <td th:text="${board.userId}"></td>
                      <td th:text="*{#temporals.format(board.postdateTime, 'yyyy-MM-dd HH:mm:ss')}"></td>
                      <td th:text="${board.hits}"></td>
                  </tr>

              </table>
              <div id="writeboard">
                  <button th:onclick="|saveReq()|">ìƒˆê¸€ì‘ì„±</button>
              </div>
              <div id="paging" th:if="${!boardList.isEmpty()}" >
                  <!-- ì²«ë²ˆì§¸ í˜ì´ì§€ë¡œ ì´ë™ -->
                  <!-- /board/paging?page=1 -->
                  <a th:href="@{/board/paging/region(parentRegion=${parentRegion},childRegion=${childRegion},page=1)}">&lt;&lt;</a>
                  <!-- ì´ì „ ë§í¬ í™œì„±í™” ë¹„í™œì„±í™” -->
                  <!-- boardList.getNumber() ì‚¬ìš©ì:2í˜ì´ì§€ getNumber()=1 -->
                  <a th:href="${boardList.first} ? '#' : @{/board/paging/region(parentRegion=${parentRegion},childRegion=${childRegion},page=${boardList.number})}">&lt;</a>

                  <!-- í˜ì´ì§€ ë²ˆí˜¸ ë§í¬(í˜„ì¬ í˜ì´ì§€ëŠ” ìˆ«ìë§Œ)
                          for(int page=startPage; page<=endPage; page++)-->
                  <span th:each="page: ${#numbers.sequence(startPage, endPage)}">
            <!-- í˜„ì¬í˜ì´ì§€ëŠ” ë§í¬ ì—†ì´ ìˆ«ìë§Œ -->
                      <span th:if="${page == boardList.number + 1}" th:text="${page}"></span>
                                  <!-- í˜„ì¬í˜ì´ì§€ ë²ˆí˜¸ê°€ ì•„ë‹Œ ë‹¤ë¥¸ í˜ì´ì§€ë²ˆí˜¸ì—ëŠ” ë§í¬ë¥¼ ë³´ì—¬ì¤Œ -->
                      <span th:unless="${page == boardList.number + 1}">
                          <a th:href="@{/board/paging/region(parentRegion=${parentRegion},childRegion=${childRegion},page=${page})}" th:text="${page}"></a>
                      </span>
                  </span>

                  <!-- ë‹¤ìŒ ë§í¬ í™œì„±í™” ë¹„í™œì„±í™”
                      ì‚¬ìš©ì: 2í˜ì´ì§€, getNumber: 1, 3í˜ì´ì§€-->
                  <a th:href="${boardList.last} ? '#' : @{/board/paging/region(parentRegion=${parentRegion},childRegion=${childRegion},page=${boardList.number + 2})}">&gt;</a>
                  <!-- ë§ˆì§€ë§‰ í˜ì´ì§€ë¡œ ì´ë™ -->
                  <a th:href="@{/board/paging/region(parentRegion=${parentRegion},childRegion=${childRegion},page=${boardList.totalPages})}">&gt;&gt;</a>
              </div>
              <div id="nonePaging" th:unless="${!boardList.isEmpty()}" style="text-align:center;">
                  ì•„ì§ ë“±ë¡ëœ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤ ğŸ¤”
              </div>
          </div>
      </div>

  </div>
  <!-- ì‚¬ì´ë“œë°”htmlì— í˜ì´ì§€ë³„ ë²„íŠ¼ í™œì„±í™” ì¶”ê°€í•˜ê³  ì‹¶ì—ˆëŠ”ë° íƒ€ì„ë¦¬í”„ fragmentëŠ” ë©”ì¸í™”ë©´ìœ¼ë¡œ jsë¥¼ ëª» ê°€ì ¸ì™€ì„œ ëª¨ë“  í˜ì´ì§€ í•˜ë‹¨ì— ì¶”ê°€í•¨ -->
  <script src="https://code.jquery.com/jquery-3.6.4.min.js" integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>
  <script type="text/javascript" th:src="@{/js/menuactive.js}"></script>
</body>

<script>

</script>

<script type="text/javascript" src="../../static/js/jquery-3.4.1.min.js" th:src="@{/js/jquery-3.4.1.min.js}"></script>
<script>
         window.addEventListener('DOMContentLoaded', function(){
            loadArea('loadParent',$(this));
            var params = (new URL(document.location)).searchParams;
            var pRegion=params.get('parentRegion');
            var cRegion=params.get('childRegion');
            loadWeather(pRegion,cRegion);
        });

        const saveReq = () => {
            var location1=document.getElementById("userLocation").value;
            var location2=document.getElementById("userLocation2").value;
            location.href = "/board/save?parentRegion="+location1+"&childRegion="+location2;
        }

        function goToBoard(){
            var location1=document.getElementById("userLocation").value;
            var location2=document.getElementById("userLocation2").value;
            location.href="/board/paging/region?parentRegion="+location1+"&childRegion="+location2;
        }

        function loadWeather(location1,location2){
            $.ajax({
                    url: "/region/api/currentWeather",
                    data:{parentRegion:location1,childRegion:location2},
                    dataType: "JSON",
                    method: "GET",
            }).done(function(res){
                $('#currentLocation1').text(res.parentRegion);
                $('#currentLocation2').text(res.childRegion);
                $('#currentTemp').text(res.weathers[0].temp);
                $('#currentMax').text("ìµœê³ ".concat(res.maxTemp));
                $('#currentMin').text("ìµœì €".concat(res.minTemp));
                var skyImage="";
                switch(res.weathers[0].sky){
                    case "ë§‘ìŒ":
                        skyImage="https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/clear-day.svg";
                        break;
                    case "êµ¬ë¦„ ë§ìŒ":
                        skyImage="https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/partly-cloudy-day.svg";
                        break;
                    case "íë¦¼":
                        skyImage="https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/cloudy.svg";
                        break;
                    case "ë¹„":
                        skyImage="https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/drizzle.svg";
                        break;
                    case "ë¹„/ëˆˆ":
                        skyImage="https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/sleet.svg";
                        break;
                    case "ëˆˆ":
                        skyImage="https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/snow.svg";
                        break;
                    case "ì†Œë‚˜ê¸°":
                        skyImage="https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/drizzle.svg";
                        break;
                    default:
                        skyImage="https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/clear-day.svg";
                }

                $('#currentSky').attr("src",skyImage);
            });
        }

</script>
<script>

        $('#userLocation').on("change",function(){
            loadArea('loadChild',$(this));
        });
        function loadArea(selectedType,selectedValue){
                $.ajax({
                    url: "/region/api",
                    dataType: "JSON",
                    method: "GET"
                }).done(function(res){
                   if(selectedType == 'loadParent'){
                        var urlParams=new URL(location.href).searchParams;
                        var loc1=urlParams.get('parentRegion');
                        var loc2=urlParams.get('childRegion');
                        $.each(res, function (index,value){
                            var hasOption=$('#userLocation option[value="'+value.parentRegion+'"]').length;
                            if(hasOption==0){
                                if(value.parentRegion===loc1){
                                    $('#userLocation').append('<option value="'+value.parentRegion+'" selected>'+value.parentRegion+'</option>');
                                }else{
                                    $('#userLocation').append('<option value="'+value.parentRegion+'">'+value.parentRegion+'</option>');
                                }

                            }
                            if(value.parentRegion===loc1){
                                if(value.childRegion===loc2){
                                    $('#userLocation2').append('<option value="'+value.childRegion+'" selected>'+value.childRegion+'</option>');
                                }else{
                                    $('#userLocation2').append('<option value="'+value.childRegion+'">'+value.childRegion+'</option>');
                                }
                            }
                        });
                   }else if(selectedType == 'loadChild'){
                        var selectedValueText = $(selectedValue).find('option:selected').text();
                        $('#userLocation2').empty();
                        $.each(res, function (index,value){

                            if(selectedValueText==value.parentRegion){
                                $('#userLocation2').append('<option value="'+value.childRegion+'">'+value.childRegion+'</option>');
                            }
                        });
                   }
                });
        }

    </script>

</html>